name: Daily Movie of the Day

on:
  schedule:
    # Run 24 times daily at random intervals (UTC)
    - cron: '7 0 * * *'   # 12:07 AM
    - cron: '23 1 * * *'  # 1:23 AM
    - cron: '41 2 * * *'  # 2:41 AM
    - cron: '15 3 * * *'  # 3:15 AM
    - cron: '52 4 * * *'  # 4:52 AM
    - cron: '8 5 * * *'   # 5:08 AM
    - cron: '34 6 * * *'  # 6:34 AM
    - cron: '19 7 * * *'  # 7:19 AM
    - cron: '47 8 * * *'  # 8:47 AM
    - cron: '3 9 * * *'   # 9:03 AM
    - cron: '28 10 * * *' # 10:28 AM
    - cron: '56 11 * * *' # 11:56 AM
    - cron: '12 12 * * *' # 12:12 PM
    - cron: '39 13 * * *' # 1:39 PM
    - cron: '5 14 * * *'  # 2:05 PM
    - cron: '51 15 * * *' # 3:51 PM
    - cron: '17 16 * * *' # 4:17 PM
    - cron: '44 17 * * *' # 5:44 PM
    - cron: '26 18 * * *' # 6:26 PM
    - cron: '9 19 * * *'  # 7:09 PM
    - cron: '37 20 * * *' # 8:37 PM
    - cron: '54 21 * * *' # 9:54 PM
    - cron: '21 22 * * *' # 10:21 PM
    - cron: '48 23 * * *' # 11:48 PM
  workflow_dispatch:  # Allow manual trigger

jobs:
  post-movie:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests atproto pycountry pillow kaggle
      
      - name: Run Movie script
        env:
          BSKY_USERNAME: ${{ secrets.BSKY_USERNAME }}
          BSKY_APP_PASSWORD: ${{ secrets.BSKY_APP_PASSWORD }}
          POST_TO_BLUESKY: 'true'
        run: |
          python scripts/movie_bluesky.py
      
      - name: Upload generated image
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: movie-backdrop
          path: output/movie_*.jpg
          retention-days: 7
